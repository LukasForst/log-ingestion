sources:
  docker:
    type: "docker_logs"
    include_containers:
      - "app-generator"
      - "redpanda"
      - "clickhouse"


transforms:
  add_timestamp:
    type: "remap"
    inputs:
      - "docker"
    source: |
      .timestamp = to_unix_timestamp(now(), unit: "milliseconds")
      .message = string!(.message)
      .host = .container_name

sinks:
  kafka_out:
    type: "kafka"
    inputs:
      - "add_timestamp"
    bootstrap_servers: "redpanda:9092"
    topic: "app_logs"
    encoding:
      codec: "json"
